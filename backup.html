
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Backup &#8212; APSW 3.39.2.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="copyright" title="Copyright" href="copyright.html" />
    <link rel="next" title="Virtual Tables" href="vtable.html" />
    <link rel="prev" title="Blob Input/Output" href="blob.html" />
 
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26815066-1']);
  _gaq.push(['_trackPageview']);
</script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="vtable.html" title="Virtual Tables"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="blob.html" title="Blob Input/Output"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">APSW 3.39.2.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Backup</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="backup">
<span id="id1"></span><h1>Backup<a class="headerlink" href="#backup" title="Permalink to this headline">¶</a></h1>
<p>A backup object encapsulates copying one database to another.  You
call <a class="reference internal" href="connection.html#apsw.Connection.backup" title="apsw.Connection.backup"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.backup()</span></code></a> on the destination database to get the
backup object.  Call <code class="xref py py-meth docutils literal notranslate"><span class="pre">step()</span></code> to copy some pages
repeatedly dealing with errors as appropriate.  Finally
<code class="xref py py-meth docutils literal notranslate"><span class="pre">finish()</span></code> cleans up committing or rolling back and
releasing locks.</p>
<p>Here is an example usage using the <strong>with</strong> statement to ensure
<code class="xref py py-meth docutils literal notranslate"><span class="pre">finish()</span></code> is called:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># copies source.main into db</span>
<span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="s2">&quot;main&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">b</span><span class="p">:</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">b</span><span class="o">.</span><span class="n">done</span><span class="p">:</span>
        <span class="n">b</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">remaining</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">pagecount</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">flush</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>If you are not using <strong>with</strong> then you’ll need to ensure
<code class="xref py py-meth docutils literal notranslate"><span class="pre">finish()</span></code> is called:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># copies source.main into db</span>
<span class="n">b</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="s2">&quot;main&quot;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">b</span><span class="o">.</span><span class="n">done</span><span class="p">:</span>
        <span class="n">b</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">remaining</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">pagecount</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">flush</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">b</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</pre></div>
</div>
<section id="important-details">
<h2>Important details<a class="headerlink" href="#important-details" title="Permalink to this headline">¶</a></h2>
<p>The database is copied page by page.  This means that there is not a
round trip via SQL.  All pages are copied including free ones.</p>
<p>The destination database is locked during the copy.  You will get a
<a class="reference internal" href="exceptions.html#apsw.ThreadingViolationError" title="apsw.ThreadingViolationError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ThreadingViolationError</span></code></a> if you attempt to use it.</p>
</section>
<section id="backup-class">
<h2>Backup class<a class="headerlink" href="#backup-class" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="apsw.Backup">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Backup</span></span><a class="headerlink" href="#apsw.Backup" title="Permalink to this definition">¶</a></dt>
<dd><p>You create a backup instance by calling <a class="reference internal" href="connection.html#apsw.Connection.backup" title="apsw.Connection.backup"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.backup()</span></code></a>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apsw.Backup.__enter__">
<span class="sig-prename descclassname"><span class="pre">Backup.</span></span><span class="sig-name descname"><span class="pre">__enter__</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#apsw.Backup" title="apsw.Backup"><span class="pre">Backup</span></a></span></span><a class="headerlink" href="#apsw.Backup.__enter__" title="Permalink to this definition">¶</a></dt>
<dd><p>You can use the backup object as a <a class="reference external" href="http://docs.python.org/reference/datamodel.html#with-statement-context-managers">context manager</a>
as defined in <span class="target" id="index-0"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0343"><strong>PEP 0343</strong></a>.  The <code class="xref py py-meth docutils literal notranslate"><span class="pre">__exit__()</span></code> method ensures that backup
is <code class="xref py py-meth docutils literal notranslate"><span class="pre">finished</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apsw.Backup.__exit__">
<span class="sig-prename descclassname"><span class="pre">Backup.</span></span><span class="sig-name descname"><span class="pre">__exit__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">etype</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">type</span><span class="p"><span class="pre">[</span></span><span class="pre">BaseException</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">evalue</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">BaseException</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">etraceback</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">TracebackType</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="k"><span class="pre">False</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#apsw.Backup.__exit__" title="Permalink to this definition">¶</a></dt>
<dd><p>Implements context manager in conjunction with <code class="xref py py-meth docutils literal notranslate"><span class="pre">__enter__()</span></code> ensuring
that the copy is <code class="xref py py-meth docutils literal notranslate"><span class="pre">finished</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="apsw.Backup.close">
<span class="sig-prename descclassname"><span class="pre">Backup.</span></span><span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">force</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#apsw.Backup.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Does the same thing as <code class="xref py py-meth docutils literal notranslate"><span class="pre">finish()</span></code>.  This extra api is
provided to give the same api as other APSW objects such as
<a class="reference internal" href="connection.html#apsw.Connection.close" title="apsw.Connection.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.close()</span></code></a>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">blob.close()</span></code> and
<a class="reference internal" href="cursor.html#apsw.Cursor.close" title="apsw.Cursor.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Cursor.close()</span></code></a>.  It is safe to call this method multiple
times.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>force</strong> – If true then any exceptions are ignored.</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="apsw.Backup.done">
<span class="sig-prename descclassname"><span class="pre">Backup.</span></span><span class="sig-name descname"><span class="pre">done</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><a class="headerlink" href="#apsw.Backup.done" title="Permalink to this definition">¶</a></dt>
<dd><p>A boolean that is True if the copy completed in the last call to <code class="xref py py-meth docutils literal notranslate"><span class="pre">step()</span></code>.</p>
</dd></dl>

<span class="target" id="index-1"></span><dl class="py method">
<dt class="sig sig-object py" id="apsw.Backup.finish">
<span class="sig-prename descclassname"><span class="pre">Backup.</span></span><span class="sig-name descname"><span class="pre">finish</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#apsw.Backup.finish" title="Permalink to this definition">¶</a></dt>
<dd><p>Completes the copy process.  If all pages have been copied then the
transaction is committed on the destination database, otherwise it
is rolled back.  This method must be called for your backup to take
effect.  The backup object will always be finished even if there is
an exception.  It is safe to call this method multiple times.</p>
<p>Calls: <a class="reference external" href="https://sqlite.org/c3ref/backup_finish.html#sqlite3backupfinish">sqlite3_backup_finish</a></p>
</dd></dl>

<span class="target" id="index-2"></span><dl class="py attribute">
<dt class="sig sig-object py" id="apsw.Backup.pagecount">
<span class="sig-prename descclassname"><span class="pre">Backup.</span></span><span class="sig-name descname"><span class="pre">pagecount</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#apsw.Backup.pagecount" title="Permalink to this definition">¶</a></dt>
<dd><p>Read only. How many pages were in the source database after the last
step.  If you haven’t called <code class="xref py py-meth docutils literal notranslate"><span class="pre">step()</span></code> or the backup
object has been <code class="xref py py-meth docutils literal notranslate"><span class="pre">finished</span></code> then zero is
returned.</p>
<p>Calls: <a class="reference external" href="https://sqlite.org/c3ref/backup_finish.html#sqlite3backuppagecount">sqlite3_backup_pagecount</a></p>
</dd></dl>

<span class="target" id="index-3"></span><dl class="py attribute">
<dt class="sig sig-object py" id="apsw.Backup.remaining">
<span class="sig-prename descclassname"><span class="pre">Backup.</span></span><span class="sig-name descname"><span class="pre">remaining</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#apsw.Backup.remaining" title="Permalink to this definition">¶</a></dt>
<dd><p>Read only. How many pages were remaining to be copied after the last
step.  If you haven’t called <code class="xref py py-meth docutils literal notranslate"><span class="pre">step()</span></code> or the backup
object has been <code class="xref py py-meth docutils literal notranslate"><span class="pre">finished</span></code> then zero is
returned.</p>
<p>Calls: <a class="reference external" href="https://sqlite.org/c3ref/backup_finish.html#sqlite3backupremaining">sqlite3_backup_remaining</a></p>
</dd></dl>

<span class="target" id="index-4"></span><dl class="py method">
<dt class="sig sig-object py" id="apsw.Backup.step">
<span class="sig-prename descclassname"><span class="pre">Backup.</span></span><span class="sig-name descname"><span class="pre">step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">npages</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#apsw.Backup.step" title="Permalink to this definition">¶</a></dt>
<dd><p>Copies <em>npages</em> pages from the source to destination database.  The source database is locked during the copy so
using smaller values allows other access to the source database.  The destination database is always locked until the
backup object is <code class="xref py py-meth docutils literal notranslate"><span class="pre">finished</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>npages</strong> – How many pages to copy. If the parameter is omitted
or negative then all remaining pages are copied. The default page
size is 1024 bytes (1kb) which can be changed before database
creation using a <a class="reference external" href="https://sqlite.org/pragma.html#modify">pragma</a>.</p>
</dd>
</dl>
<p>This method may throw a <a class="reference internal" href="exceptions.html#apsw.BusyError" title="apsw.BusyError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">BusyError</span></code></a> or <a class="reference internal" href="exceptions.html#apsw.LockedError" title="apsw.LockedError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">LockedError</span></code></a> if
unable to lock the source database.  You can catch those and try
again.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>True if this copied the last remaining outstanding pages, else false.  This is the same value as <code class="xref py py-attr docutils literal notranslate"><span class="pre">done</span></code></p>
</dd>
</dl>
<p>Calls: <a class="reference external" href="https://sqlite.org/c3ref/backup_finish.html#sqlite3backupstep">sqlite3_backup_step</a></p>
</dd></dl>

</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Backup</a><ul>
<li><a class="reference internal" href="#important-details">Important details</a></li>
<li><a class="reference internal" href="#backup-class">Backup class</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="blob.html"
                        title="previous chapter">Blob Input/Output</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="vtable.html"
                        title="next chapter">Virtual Tables</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/backup.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="vtable.html" title="Virtual Tables"
             >next</a> |</li>
        <li class="right" >
          <a href="blob.html" title="Blob Input/Output"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">APSW 3.39.2.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Backup</a></li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; <a href="copyright.html">Copyright</a> 2004-2022, Roger Binns &lt;rogerb@rogerbinns.com&gt;.
      Last updated on Aug 02, 2022.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.2.
    </div>
<div class="footer">This page uses <a href="http://analytics.google.com/">
Google Analytics</a> to collect statistics. You can disable it by blocking
the JavaScript coming from www.google-analytics.com.
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>

  </body>
</html>